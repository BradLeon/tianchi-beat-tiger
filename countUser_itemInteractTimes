# -*- coding: utf-8 -*-
"""
Created on Mon Apr 06 22:04:45 2015

@author: hp
"""

import csv
import numpy as np
import pandas as pd
def user_itemInteractTimes():
        userId=[]; itemId=[];behaviorType=[]; time=[]
        fr= open("D:\\tianchi_bigdata\\tianchi_mobile_recommend_train_user\\13to17trainingset.txt",'rb')     
        for line in fr.readlines():  
            curLine=line.strip().split('\t')
            userId.append(str(curLine[0]))  
            itemId.append(str(curLine[1]))
            behaviorType.append(str(curLine[2]))
            time.append(str(curLine[-1]))
     
        buyTime=[];buyItem=[];buyUser=[]
        cartTime=[];cartItem=[];cartUser=[]
        collectTime=[];collectItem=[];collectUser=[]
        clickTime=[];clickItem=[];clickUser=[]
        for i  in range(len(behaviorType)):
           if behaviorType[i]== '4':
                buyTime.append(time[i])
                buyItem.append(itemId[i])
                buyUser.append(userId[i])
           elif behaviorType[i]== '3':
                cartTime.append(time[i])
                cartItem.append(itemId[i])
                cartUser.append(userId[i])
           elif behaviorType[i]== '2':
                collectTime.append(time[i])
                collectItem.append(itemId[i])
                collectUser.append(userId[i])
           else:
                clickTime.append(time[i])
                clickItem.append(itemId[i])
                clickUser.append(userId[i])
        countOfItemInteraction(buyUser,buyItem,buyTime,'buy')
        countOfItemInteraction(cartUser,cartItem,cartTime,'cart')
        countOfItemInteraction(collectUser,collectItem,collectTime,'collect')
        countOfItemInteraction(clickUser,clickItem,clickTime,'click')
        
                
def countOfItemInteraction(user,item,time,behaviorType):
        pairs=[]
        pairs.append(user)
        pairs.append(item)
        tuples=zip(*pairs)
        tuples=list(set(tuples))     #去除重复出现的 userid-itemid对
        index=pd.MultiIndex.from_tuples(tuples,names=['userid','itemid'])
        data=[]
      #initial a Series to store counttimes
        for j in tuples:
             data.append(0)
        countOne=pd.Series(data,index=index)
        countThree=pd.Series(data,index=index)
        countFive=pd.Series(data,index=index)
        countSeven=pd.Series(data,index=index)
        countFourteen=pd.Series(data,index=index)
        countThirty=pd.Series(data,index=index)
        
        for j in range(len(time)):
            #countThirty[j]+=1
            #if time[j]>'2014-12-03' and time[j]<'2014-12-18':
               # countFourteen[j]+=1
            #if time[j]>'2014-12-10' and time[j]<'2014-12-18':
             #   countSeven[j]+=1
            if time[j]>'2014-12-12' and time[j]<'2014-12-18':   
                countFive[user[j]]+=1
            if time[j]>'2014-12-14' and time[j]<'2014-12-18':
                countThree[user[j]]+=1
            if time[j]>'2014-12-16' and time[j]<'2014-12-18':
                countOne[user[j]]+=1
        
        countOne.to_csv("D:\\tianchi_bigdata\\training_features\\User_Item Features\\user_item"+behaviorType+"TimesInOneday.csv")
        countThree.to_csv("D:\\tianchi_bigdata\\training_features\\User_Item Features\\user_item"+behaviorType+"TimesInThreeday.csv")
        countFive.to_csv("D:\\tianchi_bigdata\\training_features\\User_Item Features\\user_item"+behaviorType+"TimesInFiveday.csv")
       # countSeven.to_csv("D:\\tianchi_bigdata\\training_features\\User_Item Features\\user_item"+behaviorType+"TimesInSevenday.csv")
        #countFourteen.to_csv("D:\\tianchi_bigdata\\training_features\\User_Item Features\\user_item"+behaviorType+"TimesInFourteenday.csv")
        #countThirty.to_csv("D:\\tianchi_bigdata\\training_features\\User_Item Features\\user_item"+behaviorType+"TimesInThirtyday.csv")
        
        

        
user_itemInteractTimes()
